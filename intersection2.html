<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <style>
        .sqr{
            box-sizing: border-box;
            width:20px;
            height: 20px;
            background-color: #ccc;
            display: block;
            float: left;
            margin: 0px;
            padding:0px;
            line-height: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Hello Word</h1>
    <div class="grids"></div>
   
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script type="text/javascript">
        var origArray = ['mississippi', 'missouri', 'massachusetts', 'minnesota', 'washington'];
        var playWords = [];
        class aWord {
            constructor(xpos = 0, ypos = 0, val = "", dir = "h") {
                this.xpos = xpos,
                this.ypos = ypos,
                this.dir = dir,
                this.name = val,
                this.iPoints = []
            }
        }

        class interPoint {
            constructor(l = "0", thisI = 0, otherWordIndex = 0, otherI = []) {
                this.letter = l,
                this.thisI = thisI,
                this.otherWordI = otherWordIndex,
                this.otherI = otherI
            }
        }

        var gridSize = 15;
        var gridSqs = [];
$(".grids").css("width", (20*gridSize)+"px");
        var w1 = new aWord(0, 0, 'mississippi', "h");
        var w2 = new aWord(0, 0, 'missouri', "v");
        var w3 = new aWord(0, 0, 'massachusetts', "h");
        var w4 = new aWord(0, 0, 'minnesota', "v");
        var w5 = new aWord(0, 0, 'washington', "h");           

        var theWords = [w1, w2, w3, w4, w5];  

        //setWords();

        function setWords() {
            theWords[0].xpos = Math.floor(gridSize / 2) - Math.floor(theWords[0].name.length/2);
            theWords[0].ypos = Math.floor(gridSize / 2);

            // for(let h=1;h<theWords.length; h++){
            //     findIntersectionPrevWord(theWords[h], theWords[h-1]);
            // }

            for(let h=1;h<theWords.length; h++){
                findIntersectionAllWords(theWords[h], theWords);
            }

            //sub methods
            // function findIntersectionPrevWord(a, b) {                    
            //     for(let d=0; d<a.name.length; d++){
            //         let char = a.name.charAt(d); 
            //         var idx = b.name.indexOf(char);
            //         if(idx>-1){
            //             let  iPoint = new interPoint();
            //             iPoint.otherWordI = theWords.indexOf(b);
            //             iPoint.letter=char;
            //             iPoint.thisI = d;
            //             let otherI = [];
            //             while (idx != -1) {
            //                 otherI.push(idx);
            //                 idx = b.name.indexOf(char, idx + 1);
            //             }
            //             iPoint.otherI = otherI;
            //             a.iPoints.push(iPoint);
            //         } 
            //     }
            // }

            function findIntersectionAllWords(a, b) {    
                for (c=0;c<b.length;c++){
                    if(a.dir != b[c].dir){
                        for(let d=0; d<a.name.length; d++){
                            let char = a.name.charAt(d); 
                            var idx = b[c].name.indexOf(char);
                            if(idx>-1){
                                let  iPoint = new interPoint();
                                iPoint.otherWordI = c;
                                iPoint.letter=char;
                                iPoint.thisI = d;
                                let otherI = [];
                                while (idx != -1) {
                                    otherI.push(idx);
                                    idx = b[c].name.indexOf(char, idx + 1);
                                }
                                iPoint.otherI = otherI;
                                a.iPoints.push(iPoint);
                            } 
                        }
                    }
                }                     
            }

            function setXPos() {

            }

            function setYPos() {

            }
        }

        function getWord(){

        }
            
        while(playWords.length < 5){
            var wordFits = false;
            var aw = new aWord(0,0);
            var ind = Math.floor(Math.random()*origArray.length)
            aw.name = origArray[ind];
            aw.dir = playWords.length%2 == 0 ? "h": "v";

            findIntersectionAllWords(aw, playWords);
            wordFits = findPlacement(aw, playWords);
            
             if(wordFits){
                playWords.push(aw);
                origArray.splice(ind,1);
            }

            function findIntersectionAllWords(a, b) {    
                for (c=0;c<b.length;c++){
                    if(a.dir != b[c].dir){
                        for(let d=0; d<a.name.length; d++){
                            let char = a.name.charAt(d); 
                            var idx = b[c].name.indexOf(char);
                            if(idx>-1){
                                let  iPoint = new interPoint();
                                iPoint.otherWordI = c;
                                iPoint.letter=char;
                                iPoint.thisI = d;
                                let otherI = [];
                                while (idx != -1) {
                                    otherI.push(idx);
                                    idx = b[c].name.indexOf(char, idx + 1);
                                }
                                iPoint.otherI = otherI;
                                a.iPoints.push(iPoint);
                            } 
                        }
                    }
                }                     
            }
        
            function findPlacement(a, b){
                var temp = false;
                if(b.length === 0){
                    aw.xpos = Math.floor(gridSize / 2) - Math.floor(aw.name.length/2);
                    aw.ypos = Math.floor(gridSize / 2);
                    temp = true;
                }     

                if(aw.dir === "v"){
                    for(let c=0; c<aw.iPoints.length; c++){
                        temp = true;
                        var thisStartX, thisStartY, otherStartX, otherStartY
                        let ip = aw.iPoints[c];
                        otherStartX = b[ip.otherWordI].xpos;
                        otherStartY = b[ip.otherWordI].ypos;
                        for(var d=0;d<ip.otherI.length; d++){
                            temp = true;
                            thisStartX = otherStartX + ip.otherI[d];
                            thisStartY= otherStartY - ip.thisI;

                            if(thisStartY<0){
                                temp = false; 
                                    break; 
                            }
                            for(var e=0;e<aw.name.length;e++){                                
                                let gNum = thisStartX + (gridSize*(thisStartY+e));
                                if((gridSqs[gNum] !== undefined && gridSqs[gNum] !== aw.name.charAt(e))){
                                    temp = false; 
                                    break;
                                }
                            }
                            for(var e=0;e<b.length;e++){   
                                if(b[e].dir == aw.dir && (b[e].xpos == thisStartX - 1 || b[e].xpos == thisStartX + 1 )){
                                    temp = false; 
                                    break;
                                } else if(b[e].dir != aw.dir && (thisStartX == b[e].xpos + b[e].name.length || thisStartX == b[e].xpos-1)){
                                    temp = false; 
                                    break;                               
                                }
                            }
                            
                            if(gridSqs[thisStartX +(gridSize*(thisStartY-1))] != undefined){
                                 temp = false; 
                             }
                            if(gridSqs[thisStartX +(gridSize*(thisStartY +aw.name.length))] != undefined){
                                 temp = false; 
                            }
                            if(temp){
                                break;
                            }
                        }
                        if(temp){
                            aw.xpos = thisStartX;
                            aw.ypos = thisStartY;
                            break;
                        }
                    }
                }else{
                    for(let c=0; c<aw.iPoints.length; c++){
                        temp = true;
                        var thisStartX, thisStartY, otherStartX, otherStartY
                        let ip = aw.iPoints[c];
                        otherStartX = b[ip.otherWordI].xpos;
                        otherStartY = b[ip.otherWordI].ypos;
                        for(var d=0; d<ip.otherI.length; d++){
                            temp = true;
                            thisStartX = otherStartX - ip.thisI;
                            thisStartY= otherStartY + ip.otherI[d];
                            if(thisStartX<0 || thisStartX%gridSize + aw.name.length > gridSize){
                                temp = false;
                                break;
                            }
                            for(var e=0;e<aw.name.length;e++){                                
                                let gNum = thisStartX + e+ (gridSize*(thisStartY));
                                if(gridSqs[gNum] !== undefined && gridSqs[gNum] !== aw.name.charAt(e)){
                                    temp = false; 
                                    break;
                                }                                
                            }
                            for(var e=0;e<b.length;e++){   
                                if(b[e].dir == aw.dir && (b[e].ypos == thisStartY -1 || b[e].ypos == thisStartY +1 )){
                                    temp = false; 
                                    break;
                                } else if(b[e].dir != aw.dir && (aw.xpos + aw.name.length + 1 == b[e].xpos || aw.xops-1 == b[e].xpos)){
                                    temp = false; 
                                    break;
                                }
                            }
                            if(gridSqs[thisStartX - 1 +(gridSize*(thisStartY))] != undefined){
                                temp = false; 
                            }
                            if(gridSqs[thisStartX +(gridSize*(thisStartY)) + aw.name.length] != undefined){
                                temp = false; 
                            }
                            
                            if(temp){
                                break;
                            }
                        }
                        if(temp){
                            aw.xpos = thisStartX;
                            aw.ypos = thisStartY;
                            break;
                        }
                    }
                }

                //sets value in grid
                if(temp){
                    for(var h=0;h<aw.name.length; h++){
                        if(a.dir === "h"){
                            gridSqs[(aw.ypos*gridSize) + aw.xpos + h] = aw.name.charAt(h);
                        }else{
                            gridSqs[aw.xpos + (gridSize * (aw.ypos+h)) ] = aw.name.charAt(h);
                        }
                    }
                }
                return true;
            }
        }

        for(d=0;d<gridSqs.length; d++){
            var s = gridSqs[d] == undefined ? "" : gridSqs[d];
            $(".grids").append("<span class='sqr'>"+s+"</span>");
        };
        
        playWords.map(function(e){
            console.log(e.name + " x:" + e.xpos + " y:"+ e.ypos)
        });    
        
    </script>
    
</body>
</html>